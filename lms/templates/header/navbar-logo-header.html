<%page expression_filter="h" args="online_help_token"/>
<%namespace name='static' file='../static_content.html'/>
<%!
from django.urls import reverse
from django.utils.translation import gettext as _
from lms.djangoapps.ccx.overrides import get_current_ccx
from openedx.core.djangoapps.site_configuration import helpers as configuration_helpers
from openedx.features.enterprise_support.utils import get_enterprise_learner_portal
from lms.djangoapps.branding import api as branding_api
%>

<%
enterprise_customer_link = get_enterprise_learner_portal(request)
has_course = 'course' in locals() and course
is_secure_safe = 'is_secure' in locals() and is_secure or False
%>

<div class="header-logo">
  % if enterprise_customer_link:
    <!-- Trường hợp người học thuộc Enterprise -->
    <a
      href="${settings.ENTERPRISE_LEARNER_PORTAL_BASE_URL}/${enterprise_customer_link.get('slug')}"
      title="${_('{name} Dashboard').format(name=enterprise_customer_link.get('name'))}"
      class="brand-link d-inline-flex align-center"
    >
      <img class="logo logo-cusc" src="${enterprise_customer_link.get('logo')}"
           alt="${_('{name} Learner Dashboard').format(name=enterprise_customer_link.get('name'))}" />
      <span class="brand-text">CUSC Learning</span>
    </a>

  % else:
    <!-- Logo kép: CUSC + CTU -->
    <a href="${branding_api.get_home_url()}"
       class="brand-link d-inline-flex align-center"
       title="${_("{platform_name} Trang chủ").format(platform_name=static.get_platform_name())}">
      <img src="${static.url('images/logo_cusc.png')}" alt="CUSC Logo" class="logo logo-cusc" />
      <img src="${static.url('images/logo_ctu.png')}" alt="CTU Logo" class="logo logo-ctu" />
      <span class="brand-text">CUSC Learning Platform</span>
    </a>

    <!-- Tab chỉ dành cho khách -->
    % if not user.is_authenticated:
  <%
  current_path = request.path if 'request' in locals() else ''
  home_path = '/'   # Trang chủ luôn là trang public
  is_home_active = current_path == home_path
  active_home = 'active' if is_home_active else ''
  active_courses = 'active' if current_path.startswith('/courses') else ''
  active_about = 'active' if current_path.startswith('/about') else ''
  active_contact = 'active' if current_path.startswith('/contact') else ''
  active_help = 'active' if '/help' in current_path or '/support' in current_path else ''
%>


% if is_home_active:
  <span class="nav-discover ${active_home}" aria-current="page">Trang chủ</span>
% else:
  <a href="${home_path}" class="nav-discover ${active_home}">Trang chủ</a>
% endif

<div class="cusc-hover-dd">
  <a href="/courses" class="nav-discover ${active_courses} cusc-hover-dd-trigger">
    Khám phá khóa học
    <svg class="cusc-hover-dd-caret" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
      <path fill="currentColor" d="M7.41 8.58L12 13.17l4.59-4.59L18 10l-6 6l-6-6l1.41-1.42Z"/>
    </svg>
  </a>

  <ul class="cusc-hover-dd-menu" role="menu">
    <li role="none">
      <a class="cusc-hover-dd-item" role="menuitem" href="/courses">Tất cả khóa học</a>
    </li>
    <li role="none">
      <a class="cusc-hover-dd-item" role="menuitem" href="/path">Lộ trình</a>
    </li>
    <li role="none">
      <a class="cusc-hover-dd-item" role="menuitem" href="/topics">Chuyên đề</a>
    </li>
  </ul>
</div>

<a href="/about" class="nav-discover ${active_about}">Giới thiệu</a>
<a href="/contact" class="nav-discover ${active_contact}">Liên hệ</a>


% endif

  % endif

  % if has_course:
    <!-- Hiển thị thông tin khóa học khi đang trong trang khóa học -->
    <div class="course-header">
      <span class="provider">${course.display_org_with_default}:</span>
      <span class="course-number">${course.display_number_with_default}</span>
      <%
        display_name = course.display_name_with_default
        if settings.FEATURES.get('CUSTOM_COURSES_EDX', False):
          ccx = get_current_ccx(course.id)
          if ccx:
            display_name = ccx.display_name
      %>
      <span class="course-name">${display_name}</span>
    </div>
  % endif
</div>
