<%page expression_filter="h"/>
<%namespace name='static' file='../static_content.html'/>
<%!
from django.utils.translation import gettext as _
from django.utils.translation import pgettext
from django.urls import reverse
from lms.djangoapps.courseware.courses import get_course_about_section
from django.conf import settings
from common.djangoapps.edxmako.shortcuts import marketing_link
from openedx.core.djangolib.js_utils import js_escaped_string
from openedx.core.djangolib.markup import clean_dangerous_html, HTML, Text
from openedx.core.lib.courses import course_image_url
%>

<%inherit file="../main.html" />
<%block name="pagetitle">${course.display_name_with_default}</%block>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

:root {
  --blue:#0056A1;
  --green:#10B981;
  --gray:#6b7280;
  --border:#e5e7eb;
}

body {
  font-family:'Inter',sans-serif;
  background:#fff;
  margin:0;
  color:#111;
}

.course-about-container {
  max-width:1100px;
  margin:50px auto 100px;
  padding:0 20px;
}

/* TITLE */
.course-title {
  text-align:center;
  margin-bottom:30px;
}
.course-title h1 {
  font-size:44px;
  font-weight:700;
  margin-bottom:10px;
  color:var(--blue);
}
.course-title .org {
  font-size:16px;
  color:var(--gray);
}

/* HERO IMAGE */
.hero {
  text-align:center;
  margin-bottom:50px;
}
.hero img {
  width:100%;
  max-width:850px;
  border-radius:16px;
  box-shadow:0 8px 24px rgba(0,0,0,0.15);
}

/* SECTION */
.section {
  border:1px solid var(--border);
  border-radius:12px;
  padding:30px 40px;
  margin-bottom:40px;
  box-shadow:0 4px 16px rgba(0,0,0,0.05);
}
.section h2 {
  font-size:22px;
  font-weight:700;
  color:var(--blue);
  margin-bottom:15px;
}

/* DETAILS */
.details {
  font-size:16px;
  color:#333;
  line-height:1.7;
}

/* INSTRUCTOR */
.instructor {
  display:flex;
  align-items:center;
  gap:20px;
}
.instructor img {
  width:90px;
  height:90px;
  border-radius:50%;
  object-fit:cover;
}
.instructor-text {
  font-size:16px;
  line-height:1.5;
  color:#333;
}

/* SUMMARY */
.summary-item {
  margin-bottom:10px;
  color:#444;
}
.summary-item strong {
  display:inline-block;
  width:160px;
  color:#000;
}

/* ENROLL BUTTON */
.main-cta {
  text-align:center;
  margin:30px 0;
}
.main-cta a, .main-cta span {
  display:inline-block;
  text-decoration:none;
  padding:14px 36px;
  border-radius:10px;
  font-weight:700;
  font-size:16px;
  transition:all .25s;
}
.main-cta a {
  color:#fff;
  background:linear-gradient(90deg,var(--green),var(--blue));
}
.main-cta a:hover {
  transform:translateY(-3px);
  box-shadow:0 6px 14px rgba(0,86,161,.25);
}
.main-cta span.disabled {
  background:#d1d5db;
  color:#555;
  cursor:not-allowed;
}
/* Fix layout for staff/instructors inside overview content */
.details img {
  display:block;
  margin:20px 0 10px;
  width:100px;
  height:100px;
  object-fit:cover;
  border-radius:50%;
  box-shadow:0 2px 8px rgba(0,0,0,0.1);
}

/* If staff section has consecutive <img> then force spacing */
.details img + p,
.details p + img {
  margin-top:15px;
}

/* Headings inside overview */
.details h2, .details h3 {
  color:var(--blue);
  margin-top:30px;
  font-weight:700;
}

/* Paragraph spacing */
.details p {
  margin-bottom:12px;
}

/* Avoid text overlap */
.details br {
  line-height:1.8;
}

</style>

<section class="course-about-container">

  <!-- TITLE -->
  <div class="course-title">
    <h1>${course.display_name_with_default}</h1>
    <div class="org">${course.display_org_with_default}</div>
  </div>

  <!-- IMAGE -->
  <div class="hero">
    <img src="${course_image_urls['large']}" onerror="this.src='/theming/asset/images/no_course_image.png';" alt="${course.display_name_with_default}">
  </div>

  <!-- CTA BUTTON (enroll logic giữ nguyên từ code gốc) -->
  <div class="main-cta">
    % if user.is_authenticated and registered:
      <span class="disabled">${_("Already Enrolled")}</span>
      % if show_courseware_link:
        <a href="${course_target}"><strong>${_("View Course")}</strong></a>
      % endif
    % elif is_course_full:
      <span class="disabled">${_("Course is full")}</span>
    % elif invitation_only and not can_enroll:
      <span class="disabled">${_("Enrollment in this course is by invitation only")}</span>
    % elif not is_shib_course and not can_enroll:
      <span class="disabled">${_("Enrollment is Closed")}</span>
    % elif allow_anonymous:
      % if show_courseware_link:
        <a href="${course_target}"><strong>${_("View Course")}</strong></a>
      % endif
    % else:
      <%
        if ecommerce_checkout:
          reg_href = ecommerce_checkout_link
        else:
          reg_href="#"
        if single_paid_mode:
          href_class = "add-to-cart"
        else:
          href_class = "register"
      %>
      <a href="${reg_href}" class="${href_class}">${_("Enroll Now")}</a>
      <div id="register_error"></div>
    % endif
  </div>

  <!-- OVERVIEW -->
  <div class="section">
    <h2>${_("Overview")}</h2>
    <div class="details">
      ${clean_dangerous_html(get_course_about_section(request, course, "overview"))}
    </div>
  </div>

  <!-- INSTRUCTOR -->
  <div class="section">
    <h2>${_("Instructor")}</h2>
    <div class="instructor">
      <img src="${static.url('images/profile.svg')}" alt="Instructor">
      <div class="instructor-text">
        <strong>${_("Staff Member #1")}</strong><br>
        ${_("Biography of instructor/staff member #1")}
      </div>
    </div>
  </div>

  <!-- COURSE SUMMARY -->
  <div class="section">
    <h2>${_("Course Summary")}</h2>

    <div class="summary-item">
      <strong>${_("Course Number:")}</strong> ${course.display_number_with_default}
    </div>

    % if not course.start_date_is_still_default:
      <%
        course_start_date = course.advertised_start or course.start
      %>
      <div class="summary-item"><strong>${_("Classes Start:")}</strong>
        % if isinstance(course_start_date, str):
          ${course_start_date}
        % else:
          <%
            course_date_string = course_start_date.strftime('%Y-%m-%d')
          %>
          ${course_date_string}
        % endif
      </div>
    % endif

    % if course.end:
      <%
        course_end_date = course.end
      %>
      <div class="summary-item"><strong>${_("Classes End:")}</strong>
        % if isinstance(course_end_date, str):
          ${course_end_date}
        % else:
          <%
            course_date_string = course_end_date.strftime('%Y-%m-%d')
          %>
          ${course_date_string}
        % endif
      </div>
    % endif

    % if get_course_about_section(request, course, "effort"):
      <div class="summary-item"><strong>${_("Effort:")}</strong> ${get_course_about_section(request, course, "effort")}</div>
    % endif

    % if get_course_about_section(request, course, "prerequisites"):
      <div class="summary-item"><strong>${_("Requirements:")}</strong> ${get_course_about_section(request, course, "prerequisites")}</div>
    % endif
  </div>

</section>
